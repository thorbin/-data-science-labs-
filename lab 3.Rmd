---
title: "Lab 3 STAT_2600"
author: "Erik Svenneby,Jorge Robelo,Mandy Karako, Ryan Bilkie,Thorbin Atwell-Donaghey"
date: "10/9/2019"
output: html_document
---
# Black Swans lab 3
## Overall Question: How does smoking relate to other categories (such as gender, age, height, etc.) in terms of health outcomes?


### Thorbin's Question: Is there a clear relationship between health and gender regardless of tobacco use? 
```{r echo=FALSE}
library(tidyverse)
library(dplyr)
source("http://www.openintro.org/stat/data/cdc.R")
```
```{r echo=FALSE}
first_step<-mutate(cdc,genhlth=case_when(genhlth=="poor"~1,genhlth=="fair"~2,genhlth=="good"~3,genhlth=="very good"~4,genhlth=="excellent"~5))
second_step<-mutate(first_step,corr_health=case_when(abs(weight-wtdesire)==0~genhlth,abs(weight-wtdesire)<=10~genhlth,abs(weight-wtdesire)>10~genhlth-log(abs(weight-wtdesire),10)))
cdc_transf<-mutate(second_step,gender=case_when(gender=="m"~1,gender=="f"~0),smoke100=case_when(smoke100==TRUE~"100 cig.club",smoke100==0~"non-smoker"))
cdc_transf_male<-filter(cdc_transf,gender==1)
cdc_transf_fem<-filter(cdc_transf,gender==0)
## this section transforms cdc into a more useable data frame ##
```

After wrangling the self evaluated health indicator by subtracting the log base 10 of the absolute value of the difference between weight and desired weight,'corrected health' was obtained by altering the self rated health strings in an increasing value from 1 to 5 from poor to excellent. The reasoning behind this was that this would give a more accurate picture of what the actual health of the individual due to inaccurate self evaluation. A possible outlier situation includes under estimates of health from morbidly obese people, which would further obscure the true health of the individual(s).To minimize this error, log base 10 was selected. For those who have a desired weight 50 units below their current weight and already have a low general health score are likely to fall into the negative health score range. Additionally, differences between weight and desired weight that are close to 10 will have a considerable impact on corrected health score. To mitigate this, cases when the difference between weight and desired weight are less than 10 units are considered to be close enough to their self rated health value for it to be considered.

```{r echo=FALSE}
ggplot(data=cdc_transf_male,mapping=aes(x=age,y=corr_health,color=smoke100))+geom_point()+geom_smooth(color="black")+facet_wrap(~smoke100)+ggtitle("A plot comparing male smokers to male non-smokers")+labs(y="Corrected health value",x= "age (years)")+theme(legend.title=element_blank())
ggplot(data=cdc_transf_fem,mapping=aes(x=age,y=corr_health,color=smoke100))+geom_point()+geom_smooth(color="black")+facet_wrap(~smoke100)+ggtitle("A plot comparing female smokers to female non-smokers")+labs(y="Corrected health value",x= "age (years)")+theme(legend.title=element_blank())
## this section generates the plots ##
```

  These plots give an idea of health as a function of age which are separated by sex of the surveyed. Clearly the smokers and non smokers in both male and female categories should be separate which is why there are 4 plots designating the categories and sub categories (sex and sex that smoked/didnt smoke).
It can be seen from the male category that there is a small incline in health around year 70 for those who have smoked 100 cigarettes, where as there is a comparatively large decline in health for those males who havent smoked 100 cigarettes in their life. An explanation for this is that perhaps surveyed males who have smoked recently started smoking as a stress respone, leading to under exaggerated general health perception, to the degree of defeating the health correction. It is interesting that this behavior is not seen in the female category where they both tend to agree on the increase in percieved health around year 65. Possible reasons for this include groups of people between health scores weighing heavily on the general trend line. To get a better picture, more plots should be created showing one point score ranges and the associated trend lines. Due to this possible fatal error, this data is so far inconclusive.

__conclusion__: while it is not clear what the mechanism behind the odd behavior in health for male and female non-smokers is, it appears as though it appears as though both male and female smokers tend to have 2 inflection points at roughly the same ages. Depending on the time the survey was taken, this could be due to either media influence or noticed health effects due to smoking or other unhealthy life style choices. As for the individual question, there is some evidence to support that males tend to steadily decrease in health where as females tend to have an inflection point around year 60, both ending at roughly the same health at year 100. To draw any well construted conclusions, more in-depth plots of each eschelon of health need to be analyzed and fitted with a unique trend line.

### jorge's Question: What the relationship between age general health and smoking?
```{r echo=FALSE}
ggplot(data = cdc) + 
  geom_smooth(mapping = aes(x = age, y = smoke100))
```

This graph displays the relationship between age and smoking. 40 percent of people from ages between 0-25 smoke. 
Following the age of 30, there is a steady increase in the percentage of people that smoke. 
This increase persists until approximately the age of 60 where it is followed by a sharp decline in the percentage of smokers. 
The decline in smokers persists until the age of 90 where we see another sharp incline in the percentage of smokers. 

```{r echo=FALSE}
ggplot(data = cdc) + 
  geom_smooth(mapping = aes(x = age, y = smoke100,  color = genhlth))+ggtitle("my graph 1 ")
```

This graph displays the relationship between age and smoking. 40 percent of people from ages between 0-25 smoke. 
Following the age of 30 there is a steady increase in the percentage of people that smoke. 
This increase persists approximately until the age of 60 where it is followed by a sharp decline in the percentage of smokers. 
The decline in smokers persist until the age of 90 where we see another sharp incline in the percentage of smokers. 

end Jorge R

### Erik's Question: Does height play a role in the general health of smokers vs. non-smokers?
```{r echo=FALSE}
ggplot(data=cdc)+
geom_bar(mapping=aes(x=height,fill=genhlth))+
facet_wrap(~smoke100, nrow=2)+
ggtitle("General Health of Smokers vs Non-Smokers Based on Height")
```

These two bar graphs show the number of people in each general health category at each height. The data shows that the majority of 
people are clustered around average heights, which was expected, but there was a higher percentage of the top two health categories it 
seems in the average to high average height demographic, which suggests that people in the average to high average height range are 
more likely to be healthy. This was true of both smokers and non-smokers. There was also a higher percentage of healthy people in the 
non-smoker category which suggests that smokers are more inclined to be less healthy. 

end Erik Svenneby


### Ryan's Question: Do health plans have a significant effect on the health of smokers?


We first analyze the distribution of health plans among smokers and non-smokers. Are smokers more or less likely than non-smokers to have a health plan? The plot below attempts to visualize the clusters of smokers and non-smokers based on their overall health.


```{r echo=FALSE}
ggplot(data = cdc, mapping = aes(x = hlthplan, y = genhlth)) +
  geom_point(mapping = aes(color = smoke100), position = "jitter")+ggtitle("Smokers and Non-Smokers")
```


From the above, it seems that the clustering of smokers and non-smokers in the various categories is fairly uniform. 

We can analyze smokers only (see the plots below), to see how health plans effect smokers:


```{r echo=FALSE}
ggplot(data = cdc, mapping = aes(x = hlthplan, y = genhlth))+
  geom_point(data = filter(cdc, smoke100 == "1"), aes(color=smoke100),  position = "jitter", show.legend = FALSE)+ggtitle("Smokers Only")
```


We can see that, among smokers with health plans, the bulk of the clustering occurs most obviously in the "good" and "very good" categories of health. However, we can see that this is also true, proportionally, for smokers without a health plan. In both columns, the points become sparser as the the health category approaches "poor". So there doesn't seem to be any significant difference of health for smokers with plans.  

We can try to compare this with non-smokers to see if there are any obvious differences:

```{r echo=FALSE}
ggplot(data = cdc, mapping = aes(x = hlthplan, y = genhlth))+
  geom_point(data = filter(cdc, smoke100 == "0"),  position = "jitter")+ggtitle("Non-Smokers Only")
```



We immediately see that the density of points in the right column is once again strongest in the "good" and "very good" categories, and overall it seems to follow a similar distribution to the previous chart. And although it appears that the "poor" category in the left column seems sparser, and the "excellent" category in the right column is somewhat denser (suggesting perhaps that non-smokers tend to be healthier overall than smokers), the proportionality *within* columns is unchanged and the overall trend remains steady: all four columns seem to cluster in a similar pattern--densest in the "good" and "very good" categories and sparsest in the "poor" category.

In other words, the overall distribution of health between smokers and non-smokers does not seem to be obviously affected by the presence or absence of a health plan.

end Ryan Bilkie


### Mandy's Question: "Does weight play a role in the general health of non-smokers vs. smokers?"
```{R echo=FALSE}
ggplot(data=cdc) + 
  geom_bar(mapping=aes(x=weight,fill=genhlth)) +
  facet_wrap(~smoke100, nrow=2) +
  ggtitle("General Health of Non-Smokers vs Smokers Based on Weight")
```

  These two graphs compare non-smokers (graph on the top) to smokers (graph on the bottom) based on height. Each bar represents how many 
  people are in that weight range. The different colors on the bar represent the health of those people with that specific weight, ranging from 1-5, 1 being poor
  and 5 being excellent. Conclusively, the graph shows that more people are non-smokers than smokers and that is consistent in every weight range. 
  If we focus on just two different weights, 150 pounds and 200 pounds, each weight class shows significantly more people in the "excellent" red range. 
  Therefore, we can conclude that despite your weight, non-smokers are consistently healthier which also tells us that weight does not play a factor in the overall health of non-smokers vs smokers. 

  end Mandy Karako 
  
## Group conclusion: 

Mandy conclusion: weight does not play a role in health between smokers and non smokers.
Ryan conclusion: health plan does not play a role in health. 
Erik conclusion: height appears to have a higher sense of personal health. this sense of health was prononced more in the non smoker category.
Jorge conclusion: During middle life age ranges, there tend to be fewer smokers and therefore better health.
Thorbin conclusion: accd. to the data it appears as though smoking in males leads to better end of life health where as in females smokers tend to have sort of an inverse cube relation to health and non smokers have a steep decline in health until their 60s then a small increase to death. Point being smoking at least  
