---
title: "lab 9: How can we explain voter turnouts by age/race/...etc using data?"
author: "Erik Svenneby, Jorge Robelo, Mandy Karako, Ryan Bilkie, Thorbin Atwell"
date: "10/17/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(tidyr)
library(dplyr)
library(readxl)
library(ggplot2)
install.packages('gsheet') #its to read googlesheets needs to be installed 
library(gsheet)
#website Erik found that has solid data: Electionlab.mit.edu/data
```
##Ryan's Question: How large of a percentage are young voters in swing states?

Hopefully one of the lessons that any Presidential candidate should take away from the 2018 election is that it is not the popular vote but the swing states--and one's ability to appeal to them--that decide elections. Here we will look at how the demographic in question (voters age 18-24) behaves in swing states; whether there are any interesting trends we can identify; and then hopefully determine how much in terms of resources we should devote to young people in these states.

We know that the so-called "perennial swing states" are: Colorado, Florida, Iowa, Michigan, Minnesota, Ohio, Nevada, New Hampshire, North Carolina, Pennsylvania, Virginia, and Wisconsin. It's an initially plausible hypothesis that voters in these states will tend to skew towards an older demographic--as young people gravitate to magnet cities on the coast, both as university students and young professionals. If this is true, the conclusion would be that elections are decided by appealing to older demographics, as these dominate the swing states. In order to test this idea, we will look at a data set from https://www.census.gov/data/tables/time-series/demo/voting-and-registration/p20-583.html -- table 4c, which is the governmental electoral data for November 2018. Unfortunately, this data set is oddly formatted and will require a thorough cleaning:



```{r}

library(janitor) # to clean column names. If it doesn't load for you, just install.packages("janitor")

url <- "https://www2.census.gov/programs-surveys/cps/tables/p20/583/table04c.xlsx"
destfile <- "table04c.xlsx"

curl::curl_download(url, destfile)
data <- read_excel(destfile)

data = data %>% 
  slice(-c(1:3)) 

head(data)

 
col_names = c(data[1,1:4],data[2,5:14])
names(data) =  as.vector(unlist(col_names))
names(data)
data = data %>% slice(-1,-2) %>% clean_names()
```

Now that we've removed the unnecessary columns and cleaned the names, we'll need to filter by the variables we're interested in, as well as fill in some missing values:

```{r}
# select relevant columns. 
req_cols = c("state", "age", "total_voted", "percent_voted_total", "total_population")

req_data = data %>% 
  select(req_cols) %>%
  fill(state)

head(req_data)
```

Here we can clearly see that there is a linear increase in percentage of the voting electorate as age categories increase. Simply put, the candidate who can better appeal to older people commands, nationwide, a higher vote count. Let's zoom in on the swing states to see how young people vote in finer detail:

```{r}
swing_states = c("COLORADO", "FLORIDA", "IOWA", "MICHIGAN", "MINNESOTA", "OHIO", "NEVADA", "NEW HAMPSHIRE", "NORTH CAROLINA", "PENNSYLVANIA", "VIRGINIA", "WISCONSIN")

req_data = req_data %>% 
  mutate(is_swing_state = ifelse(state %in% swing_states, "yes", "no"))

req_data %>% head

young_voter_pop = req_data %>% 
  filter(age != "Total") %>% 
  mutate(total_voted = as.numeric(total_voted),
         total_population = as.numeric(total_population)) %>% 
  group_by(state) %>% 
  mutate(total_voted_state = sum(total_voted),
         perc_of_total_voted_state = total_voted/total_voted_state) %>% 
  data.frame %>% 
  filter(age == "18 to 24")

young_voter_pop %>% head


```

Now we have the data in the final form we need to generate a visualization to help us understand what fraction of the voting public our demographic constitutes:

```{r}
young_voter_pop %>% 
  ggplot(aes(x = state, y = perc_of_total_voted_state, fill = is_swing_state)) +
  geom_bar(stat = 'identity') +
  theme(axis.text.x = element_text(size = 7, angle = 90)) + 
  labs(x = "State",
       y = "18-24 voter percentage",
       title = "Young Voters and Swing States")
```

We might first notice the fact that voters 18-24 fall in the range of about 3% (for Maine) to 10% (Alaska) on the high end, whereas if we only analyze the swing states, the range is much smaller, with about 5% in Ohio to just under 8% in Wisconsin. This is valuable in and of itself in trying to decide how much of our resources we should allocate to a voting population of that size, but it might also help us tailor our message differently to, say, Ohio, then to Wisconsin. 

While it remains true that young voters make up the smallest percentage in terms of nationwide turnout, the above, finer analysis shows how that macro picture can sometimes obscure the truth, and consequently lead a candidate to erroneously neglect this demographic in key states. In particular, this analysis shows that our campaign should pay particular attention to young voters in states that have had relatively strong turnout in recent history for that demographic--in particular: Wisconsin, North Carolina, and Nevada.


#end Ryan
####Thorbin's question: How does wage and annual income correspond to voter turnout? 



#Jorges analysis. 

```{r}
library(tidyverse)
library(readxl)
install.packages('gsheet')
library(gsheet)
datagog<-gsheet2tbl('https://docs.google.com/spreadsheets/d/1or-N33CpOZYQ1UfZo0h8yGPSyz0Db-xjmZOXg3VJi-Q/edit#gid=1670431880')
```

#tidding 
```{r}
data2<-datagog[-c(1), ]
data2<-data2 %>% rename(Years = X1)
data2<-data2 %>% rename(Presiden_vote = X9)
data2<-data2 %>% rename(Voting_age_pop = Denominators)

data3<-data2

data3$Years <- as.numeric(as.character(data3$Years))

data3$Presiden_vote <- as.numeric(as.character(gsub(",","",data3$Presiden_vote)))
data3$Voting_age_pop <- as.numeric(as.character(gsub(",","",data3$Voting_age_pop)))

```

#manipulating data and variables
```{r}
data4 <- data3 %>%
  mutate(Presiden_vote = Presiden_vote/1000000)

data5<-data4%>% filter(State=="United States")%>%
  ggplot(mapping = aes(x = Years, y = Presiden_vote)) +
  geom_point(method = lm)+
  scale_x_continuous(breaks=seq(1980,2014,4)) +
  scale_y_continuous(breaks=seq(10,180,10))+scale_y_continuous("US Presidential vote by Million")+
  geom_smooth(method=lm, se=FALSE)

```

#Ploting 
```{r}
plot(data5)
```
#when it comes to general elections, it seems that the trend indicates that as the years go by there is an increase in voter turn out. possible explanations and contributing factors to this phenomenon may be related to an increase in political heuristic via to use of the social networks. I also suspect that political polarization might play a role. 

#funtions used from tidyverse: ggplot, filter, geom_smooth, mutate, rename. funtions used outside tidyverse:as.numeric, as.character, gsub, library(gsheet)
#end jorges.
