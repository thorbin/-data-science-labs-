---
title: "lab 4 BlackSwans"
author: "Erik Svenneby, Jorge Robelo, Mandy Karako, Ryan Bilkie, Thorbin Atwell"
date: "9/21/2019"
output: html_document
---

```{r setup, include=FALSE}
library("tidyverse")
library(dplyr)
babies_1 <- read_csv("https://raw.githubusercontent.com/ervance1/Sp2018-Data-Science-repo/master/babies2a.dat")
babies_1 <- rename(babies_1, bwtoz = `bwt/oz`)
```
### Thorbin's question: Is income and level of smoking related to number of mature births? 

```{R} 
#data frame creation block#
babies<-babies_1
babies_prem<-babies %>% filter(gestation<270,!is.na(gestation)) %>% group_by(inc,number) %>% summarize(births=sum(parity)) %>% group_by(number)
babies_matu<-babies %>% filter(gestation>=270,!is.na(gestation)) %>% group_by(inc,number) %>% summarize(births=sum(parity)) %>% group_by(number)
# these lines give total number of births to income grades differentiating between premature and mature births and level of smoking # 

```
Non-default layers used: dark theme, dodge position, stat=identity, fill=number, x,y,z,plot and legend labels.
```{R}
#plot chunk# 
ggplot(data=babies_prem,mapping=aes(x=inc,y=births,group=number,color=number,fill=number))+geom_bar(stat="identity",position="dodge")+theme_dark()+ggtitle("Premature births grouped by income braket")+xlab("Income bracket")+ylab("number of births")+labs(fill="smoking spectrum")
```

  This plot shows the premature birth numbers categorized by income bracket. This was accmplished by initially filtering gestation days to be less than 270. Grouping by number (and income), which is how many cigarettes were smoked a day for past and current smokers. Considering that the data represents only people who smoke, number is how many cigarettes the subjects smoke per day. Once grouped, parity which was the number of births (live or still) each subject produced was summed using a summary function to give a total number of births per income bracket. This resulting data frame was then again grouped by number to give a decent spread of smoking intensity representation per income bracket. 
```{r}
ggplot(data=babies_matu,mapping=aes(x=inc,y=births,group=number,color=number,fill=number))+geom_bar(stat="identity",position="dodge")+theme_dark()+ggtitle("Mature births grouped by income braket")+xlab("Income bracket")+ylab("number of births")+labs(fill="smoking spectrum")
```

  The same method described in the above section was used to generate a bar plot describing births per income bracket however this time gestation was filtered from values of 270 days and up. This yielded the data frame representing mature births (still or live). 
  
Analysis: Looking at the mature births plot, it is immediatley obvious that in all income brackets, those who are on the darker colors of the spectrum (less smoking per day) have higher birth numbers. It is worth noting that this trend is observed between both categories however the mature birth category eclipses the premature birth category in terms of birth numbers for those who dont smoke. There is a notable exception in the mature categry belonging to subjects in the $5-7.5 k income bracket, this spike could perhaps be that these upper middle class people are able to have one party abstain from working leading to less stres on the mother during pregnancy. As for income based premature birth rate, since the same sort of trend in births peaks at the lower middle class, it can be said that generally economic class (in the mid 20th century) did not play an observable role in premature birth rates. Due to the massive deficit between number of mature and premature births in the non-smoker category for most economic classes, it is abundantly clear that a large proportion of over all births belong to non-smoking mothers indicating that tobacco use can lessen an expecting couples chances of a mature birth which affirms the Surgeon General's conclusion regarding likleyhood of mature births belonging to non smoking mothers. 


### Ryan's question: Are income and education possible confounding variables?

I, Ryan Bilkie, created several plots in an attempt to answer the question: "which variables are similar between smokers and non-smokers? Which are different?" 

If two or more variables share a similar distribution with a separate variable, it is possible that we have a confounding variable, which means there might be a "hidden" causal factor. In this case, to answer the question whether smoking itself leads to bad birth outcomes (as the Surgeon General asserts), a proper analysis requires us to check other possible causes--for instance, do smokers tend to have less income, or less education? Could there be a race-related component? We cannot enumerate all possible causal factors, but if there is a close relationship to any of these three variables and the tendency to smoke, it might warrant further investigation as a causal mechanism.

I first used a geom_smooth function to examine the relationship between income and smoking. My original hypothesis was that it was possible that lower-income people in the United States smoke more, and therefore the causal link with birth outcomes might be the lower overall health of lower-income people. The data showed clearly that this was false: 

```{r}
ggplot(data = babies)+
  geom_smooth(mapping = aes(x = inc, y = number))
```

This shows that those with average and above-average incomes tend to smoke more than those with low incomes, so income cannot be the variable that confounds smoking with birth outcomes.  

What about education? Is it possible that those with lower education tend to smoke more, and that it is the lack of education itself that is somehow causally responsible for bad birth outcomes (say, through improper nutrition, or some other factor casued by a lack of education)? I compared the mother's education on the x-axis to her tendency to smoke on the y-axis using a scatter plot:

```{r}
ggplot(data = babies)+
  geom_point(mapping = aes(x = med, y = number, color = number), position = "jitter")
```

These data seem to also disconfirm my hypothesis--there is no obvious relationship between education levels and tendency to smoke. In fact, the distribution seems fairly even throughout, and the strongest cluster of non-smokers even seems to be located at the "2" variable, which represents, "high school graduate, no other schooling". On closer examination, there do seem to be more regular smokers in the 1 and 2 categories than in the 4-6 categories, and the "1" category (did not finish high school), even seems to be the only category weighted more in favor of smokers than non-smokers. So the relationship is weak, but it's possible that a mother's education level is a confounding variable, and this might warrant further investigation.

Finally, I used a facet wrap to see if the distributions of smokers and non-smokers differs across races in the United States (with mother's education on the x-axis):

```{r}
ggplot(data = babies)+
  geom_point(mapping = aes(x = inc, y = number, color = number))+
  geom_smooth(mapping = aes(x = inc, y = number, color = number))+
  facet_wrap(~ mrace)
```

The data show markedly different distributions between whites (0-5) and Mexicans (6), the latter of which smoke far less, regardless of income, whereas Asians seem to smoke more as income grows and blacks smoke less. So there is not uniform distribution between races as regards smoking trends, which might imply the need to further investigate potential confounding variables correlated to geographic, genetic or cultural differences and how they relate to birth outcomes.


# Jorges Question- exploring if mothers race corralates with premature deliveries, groups smoking and nonsmoking, levels 6(white, black, mexican, asian, mix, unknown)
view(babies)
```
babies_1<-babies %>% filter (smoke==1)
babies_2<-babies %>% filter (smoke==0)
babies_1
babies_2

```


#smoked
```
ggplot(data = babies_1) +
  geom_histogram(mapping = aes(x = mrace), binwidth = 0.5) # total distribution of mraces (mother race) that smoked

mrace_smoked <- babies_1 %>%
  group_by(mrace, smoke==1,) %>% 
  summarize(mean(Premature))

mrace_smoked #  getting the mean of mraces with premature birth - smoked 
```
#nonsmoked
```
ggplot(data = babies_2) +
  geom_histogram(mapping = aes(x = mrace), binwidth = 0.5) #total distribution of mrace nonsmoke

mrace_Nosmoked <- babies_2 %>%
  group_by(mrace, smoke==0) %>% 
  summarize(mean(Premature))

mrace_Nosmoked #  getting the mean of mraces with premature birth - nonsmoked

```
# by compering the means in both groups of mothers race, smoking and nonsmoking, we can see that poeple who were categorized as white (mrace <=5)
# and Asian (mrace==8) have higher rates of premature birth in the 1960's than the rest of the survayed groups. 
# however, all groups tend to have more frequent premature births if the mothers smoked dispite the mother race. 
# further investigations should examine how race became biology, a situational factor, in the case of Whites and asians and how it affected birth and the offspirngs wieght
# during this time period. This would help locate confounding variables. 

```
ggplot(data = babies_1) + 
  stat_summary(
    mapping = aes(x = mrace, y = gestation),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  )
```
# in the smoking group we can obseve that the 9th point (asian group) has porportialy grater variability towards having babies under 270 lb than the rest of the groups, however the white
# groups (0-5), and the black group have around the same variablility and distribution. finaly group 6 (mexicans) had the highest birth wights.
```
ggplot(data = babies_2) + 
  stat_summary(
    mapping = aes(x = mrace, y = gestation),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  )
```
#in the non smoking group we can obseve that the 9th point (asian group) has porportialy grater variability towards having babies under 270 lb 

